angular.module('myApp', ['ui.router', 'ui.bootstrap','oc.lazyLoad'])
//全局配置
    .config(lazyLoad)
    .config(httpRequestHead)
    .config(router)
    //WEB程序启动初始化(事件监听$on，模态框封装，全局作用域$rootScope)
    .run();

//懒加载
function lazyLoad($ocLazyLoadProvider) {
    $ocLazyLoadProvider.config({
        debug: false,
        events: true,
        modules: [{
            name: 'home',
            files: []
        }]
    })
}

//配置请求头和数据序列化
function httpRequestHead($httpProvider) {
    // Set x-www-form-urlencoded Content-Type
    $httpProvider.defaults.headers.common['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';
    $httpProvider.defaults.headers.patch['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';
    $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';
    $httpProvider.defaults.headers.put['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';
    // Set up global transformRequest function
    $httpProvider.defaults.transformRequest = function (data) {
        if (data === undefined) {
            return data;
        }
        return $.param(data);
    };
}

//路由
function router($stateProvider, $urlRouterProvider) {
    //更改url格式配置为html5，去掉#号（去哈希）
    // $locationProvider.html5Mode(true);
    //封装路由懒加载函数
    var _lazyLoad = function (loaded) {
        return function ($ocLazyLoad) {
            return $ocLazyLoad.load(loaded, {serie: true});
        }
    };
    //配置路由
    $urlRouterProvider.otherwise('/findJobs');
    $stateProvider
    //前台首页
        .state('home', {
            url: '',
            templateUrl: 'pages/home.html',
            abstract: true,// true 表明此状态不能被显性激活，只能被子状态隐性激活
            controller: 'homeCtrl as vm',
            resolve: {
                loadMyFile: _lazyLoad([
                    'js/controllers/homeCtrl.js',
                    'css/home.css',
                    'css/public.css'
                ])
            },
            cache: false
        })
        .state('home.findElites',{
            url:'/findElites',
            templateUrl: 'pages/findElites.html',
            // controller: 'findElitesCtrl as vm',
            resolve: {
                loadMyFile: _lazyLoad([
                    // 'js/controllers/findElitesCtrl.js',
                    'css/findElites.css',
                    'css/public.css'
                ])
            },
            cache: false
        })
        .state('home.findJobs',{
            url:'/findJobs',
            templateUrl: 'pages/findJobs.html',
            controller: 'findJobsCtrl as vm',
            resolve: {
                loadMyFile: _lazyLoad([
                    'js/controllers/findJobsCtrl.js',
                    'css/findJobs.css',
                    'css/public.css'
                ])
            },
            cache: false
        })

}

